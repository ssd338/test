<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="LoginUsr">

	<typeAlias  alias="egovMap" type="egovframework.rte.psl.dataaccess.util.EgovMap"/>
	<typeAlias  alias="joinVO" type="home.join.service.JoinVO"/>

	<!-- 로그인 처리를 위한 resultMap -->
	<resultMap id="login" class="home.join.service.JoinVO">
		<result property="usrNo" column="usr_no"/>
		<result property="usrId" column="usr_id"/>
		<result property="encUsrPw" column="enc_usr_pw"/>
		<result property="birthday" column="birthday"/>
		<result property="sexCd" column="sex_cd"/>
		<result property="encUsrNm" column="enc_usr_nm"/>		
		<result property="encEmail" column="enc_email"/>		
		<result property="encMobileNo" column="enc_mobile_no"/>		
		<result property="encPhoneNo" column="enc_phone_no"/>		
		<result property="encHZipcode" column="enc_h_zipcode"/>		
		<result property="encHAddress1" column="enc_h_address1"/>		
		<result property="encHAddress2" column="enc_h_address2"/>		
		<result property="doroPost" column="doro_post"/>		
		<result property="doroAddr1" column="doro_addr1"/>		
		<result property="doroAddr2" column="doro_addr2"/>		
		<result property="doroAddrYn" column="doro_addr_yn"/>		
		<result property="option1" column="option1"/>		
		<result property="option2" column="option2"/>		
		<result property="option3" column="option3"/>		
		<result property="option4" column="option4"/>		
		<result property="crtDt" column="crt_dt"/>		
		<result property="udtDt" column="udt_dt"/>		
		<result property="ESNTLID" column="ESNTL_ID"/>		
<!-- 	<result property="LASTLOGINPNTTM" column="LAST_LOGIN_PNTTM"/>		
		<result property="LASTLOGINIP" column="LAST_LOGIN_IP"/>		
		<result property="CRTFCNO" column="CRTFC_NO"/>		
		<result property="LOGINTRYCNT" column="LOGIN_TRY_CNT"/>		 -->
	</resultMap>
	
	<!-- 아이디 찾기를 위한 resultMap 
	<resultMap id="id" class="egovframework.com.cmm.LoginVO">
		<result property="id" column="id" columnIndex="1"/>
	</resultMap>
	-->
	<!-- 비밀번호 처리를 위한 resultMap 
	<resultMap id="password" class="egovframework.com.cmm.LoginVO">
		<result property="password" column="password" columnIndex="1"/>
	</resultMap>
	-->
	<!-- 일반 로그인 -->
	<select id="loginDAO.actionLogin" resultMap="login" parameterClass="joinVO">
        <!-- 일반회원 -->
        SELECT usr_no
             , usr_id
             , enc_usr_pw
             , birthday
             , sex_cd
             , enc_usr_nm
             , enc_email
             , enc_mobile_no
             , enc_phone_no
             , enc_h_zipcode
             , enc_h_address1
             , enc_h_address2
             , doro_post
             , doro_addr1
             , doro_addr2
             , doro_addr_yn
             , option1
             , option2
             , option3
             , option4
             , crt_dt
             , udt_dt
             , ESNTL_ID
        FROM tbl_usrm
        WHERE usr_id = #usrId#
              AND enc_usr_pw = #encUsrPw#
	</select>
	
	<!-- 인증서 로그인
	<select id="loginDAO.actionCrtfctLogin" resultMap="login">
		<![CDATA[
		SELECT emplyr_id AS id
		     , USER_NM AS name
		     , password AS password
		     , ihidnum AS ihidNum
		     , email_adres AS email
		     , 'USR' AS userSe
		     , orgnzt_id AS orgnztId
		     , ESNTL_ID AS uniqId
		  FROM LETTNEMPLYRINFO
		 WHERE sub_dn = #dn#
		]]>
	</select>
	 -->
	<!-- 아이디 찾기
	<select id="loginDAO.searchId" resultMap="id">
		<isEqual property="userSe" compareValue="GNR">
			<![CDATA[
			SELECT mber_id AS id
			  FROM LETTNGNRLMBER
			 WHERE mber_nm = #name#
			   AND mber_email_adres = #email#
			   AND mber_sttus = 'P'
			]]>
		</isEqual>
		<isEqual property="userSe" compareValue="ENT">
			<![CDATA[
			SELECT entrprsmber_id AS id
			  FROM LETTNENTRPRSMBER
			 WHERE cmpny_nm = #name#
			   AND applcnt_email_adres = #email#
			   AND entrprs_mber_sttus = 'P'
			]]>
		</isEqual>
		<isEqual property="userSe" compareValue="USR">
			<![CDATA[
			SELECT emplyr_id AS id
			  FROM LETTNEMPLYRINFO
			 WHERE USER_NM = #name#
			   AND email_adres = #email#
			   AND emplyr_sttus_code = 'P'
			]]>
		</isEqual>
	</select>
	 -->
	<!-- 비밀번호 찾기 
	<select id="loginDAO.searchPassword" resultMap="password">
		<isEqual property="userSe" compareValue="GNR">
			<![CDATA[
			SELECT password AS password
			  FROM LETTNGNRLMBER
			 WHERE mber_id = #id#
			   AND mber_nm = #name#
			   AND mber_email_adres = #email#
			   AND password_hint = #passwordHint#
			   AND password_cnsr = #passwordCnsr#
			   AND mber_sttus = 'P'
			]]>
		</isEqual>
		<isEqual property="userSe" compareValue="ENT">
			<![CDATA[
			SELECT entrprs_mber_password AS password
			  FROM LETTNENTRPRSMBER
			 WHERE entrprsmber_id = #id#
			   AND cmpny_nm = #name#
			   AND applcnt_email_adres = #email#
			   AND entrprs_mber_password_hint = #passwordHint#
			   AND entrprs_mber_password_cnsr = #passwordCnsr#
			   AND entrprs_mber_sttus = 'P'
			]]>
		</isEqual>
		<isEqual property="userSe" compareValue="USR">
			<![CDATA[
			SELECT password AS password
			  FROM LETTNEMPLYRINFO
			 WHERE emplyr_id = #id#
			   AND USER_NM = #name#
			   AND email_adres = #email#
			   AND password_hint = #passwordHint#
			   AND password_cnsr = #passwordCnsr#
			   AND emplyr_sttus_code = 'P'
			]]>
		</isEqual>
	</select>
	-->
	<!-- 변경된 비밀번호를 저장 
	<update id="loginDAO.updatePassword">
		<isEqual property="userSe" compareValue="GNR">
			<![CDATA[
			UPDATE LETTNGNRLMBER
			   SET password = #password#
			 WHERE mber_id = #id#
			]]>
		</isEqual>
		<isEqual property="userSe" compareValue="ENT">
			<![CDATA[
			UPDATE LETTNENTRPRSMBER
			   SET entrprs_mber_password = #password#
			 WHERE entrprsmber_id = #id#
			]]>
		</isEqual>
		<isEqual property="userSe" compareValue="USR">
			<![CDATA[
			UPDATE LETTNEMPLYRINFO
			   SET password = #password#
			 WHERE emplyr_id = #id#
			]]>
		</isEqual>
	</update>
	-->
</sqlMap>
